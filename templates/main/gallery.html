{% extends "shared/base.html" %}
{% load static %}

{% block title %}Gallery{% endblock %}

{% block extra_head %}
  <!-- Homepage-specific styles only -->
  <link rel="stylesheet" href="{% static 'css/gallery.css' %}" />

  <!-- Shared styles for layout components -->
  <link rel="stylesheet" href="{% static 'css/miniview.css' %}">
{% endblock %}

{% block content %}
<div class="gallery-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-section"> 
      <h3>All Categories</h3>
      <form method="get" id="categoryForm">
        <ul>
          {% for cat in categories %}
          <li>
            <label>
              <input type="radio" name="category" value="{{ cat.slug }}"
                    {% if selected_category == cat.slug %}checked{% endif %}>
              {{ cat.name }} ({{ cat.product_count }})
            </label>
          </li>
          {% endfor %}
          <li>
            <label>
              <input type="radio" name="category" value=""
                    {% if not selected_category %}checked{% endif %}>
              All
            </label>
          </li>
        </ul>

        <h3>Price</h3>
        <input type="range" name="price_max" min="{{ min_price|default:0 }}" max="{{ max_price|default:1000 }}" value="{{ request.GET.price_max|default:max_price }}" id="priceRange">
        <span id="priceDisplay">₱ {{ min_price|default:0}} - ₱ {{ request.GET.price_max|default:max_price}} </span>
        
        <button class="filter-btn">Filter</button>
      </form>
    </div>

      <!-- <input type="range" name="price_max" min="{{ min_price|default:0 }}" max="{{ max_price|default:1000 }}" value="{{ request.GET.price_max|default:max_price }}" id="priceRange">
      <span id="priceDisplay">₱{{ min_price|default:0}} - ₱ {{ request.GET.price_max|default:max_price}} </span> -->

    <div class="sidebar-section">
      <h3>Rating</h3>
      <ul class="rating-filter">
        <li><label><input type="checkbox"> <span>★★★★★</span> 5.0</label></li>
        <li><label><input type="checkbox"> <span>★★★★☆</span> 4.0 & up</label></li>
        <li><label><input type="checkbox"> <span>★★★☆☆</span> 3.0 & up</label></li>
        <li><label><input type="checkbox"> <span>★★☆☆☆</span> 2.0 & up</label></li>
        <li><label><input type="checkbox"> <span>★☆☆☆☆</span> 1.0 & up</label></li>
      </ul>
    </div>
  </aside>

  <!-- Main Product Grid -->
  <main class="product-gallery">

    <div class="gallery-controls">
      <select id="sortDropdown">
        <option>Sort by: Latest</option>
        <option>Price: Low to High</option>
        <option>Price: High to Low</option>
        <option>Rating: High to Low</option>
      </select>
      <span class="results-count">32 results found</span>
    </div>


    <div class="product-grid">
  {% for product in products %}
    <div class="product">
      <!-- Whole product card clickable -->
      <a href="{% url 'main:product_detail' product.id %}" class="product-card-link">
        <div class="product-img-wrap">
          <img src="{{ product.image_url }}" alt="{{ product.name }}">
        </div>

        <div class="product-info-left">
          <div class="product-title">
            <h3>{{ product.name }}</h3>
          </div>
          <div class="price">₱ {{ product.price }}</div>
          <div class="stock">Stock: {{ product.stock }}</div>

          <!-- Optional: Progress bar for stock (only show if stock > 0 and you want this feature) -->
          {% if product.stock > 0 %}
            <progress value="{{ product.stock }}" max="100"></progress>
          {% endif %}
        </div>
      </a>

      <!-- Add to Cart -->
      <button type="button"
              class="add-to-cart-btn open-miniview-btn"
              data-product-id="{{ product.id }}"
              {% if product.stock == 0 %}disabled{% endif %}>
        Add to cart
      </button>
    </div>
  {% endfor %}
</div>





      <!-- Add more cards or later loop through products with Django -->
    </div>

    <div class="pagination">
      <button>&laquo;</button>
      <button class="active">1</button>
      <button>2</button>
      <button>3</button>
      <button>4</button>
      <button>&raquo;</button>
    </div>
  </main>
</div>


    <!-- ==== vvv MODALS (hidden by default) vvv ==== -->

    <!--Product Miniview-->
    {% include 'shared/product_miniview_cart.html' %}

    <!-- ==== ^^^ MODALS (hidden by default) ^^^ ==== -->


<script>
document.querySelectorAll('#categoryForm input[type=radio]')
  .forEach(radio => {
    radio.addEventListener('change', () => {
      document.getElementById('categoryForm').submit();
    });
  });
</script>

<script>
const form = document.getElementById('filterForm');

document.querySelectorAll('#filterForm input[name=category]').forEach(radio => {
  radio.addEventListener('change', () => form.submit());
});

document.getElementById('sortDropdown').addEventListener('change', () => form.submit());

const priceRange = document.getElementById('priceRange');
const priceDisplay = document.getElementById('priceDisplay');
priceRange.addEventListener('input', () => {
  priceDisplay.textContent = `₱ {{ min_price|default:0 }} - ₱ ${priceRange.value}`;
});

priceRange.addEventListener('change', () => form.submit());
</script>

{% endblock %}
