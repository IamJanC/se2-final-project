{% extends "shared/base.html" %}
{% load static %}

{% block title %}Gallery{% endblock %}

{% block extra_head %}
  <!-- Homepage-specific styles only -->
  <link rel="stylesheet" href="{% static 'css/gallery.css' %}" />

  <!-- Shared styles for layout components -->
  <link rel="stylesheet" href="{% static 'css/miniview.css' %}">
{% endblock %}

{% block content %}
<div class="gallery-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-section"> 
      <h3>All Categories</h3>
      <form method="get" id="categoryForm">
        <ul>
          {% for cat in categories %}
          <li>
            <label>
              <input type="radio" name="category" value="{{ cat.slug }}"
                    {% if selected_category == cat.slug %}checked{% endif %}>
              {{ cat.name }} ({{ cat.product_count }})
            </label>
          </li>
          {% endfor %}
          <li>
            <label>
              <input type="radio" name="category" value=""
                    {% if not selected_category %}checked{% endif %}>
              All
            </label>
          </li>
        </ul>

        <h3>Price</h3>
        <input type="range" name="price_max" min="{{ min_price|default:0 }}" max="{{ max_price|default:1000 }}" value="{{ request.GET.price_max|default:max_price }}" id="priceRange">
        <span id="priceDisplay">₱{{ min_price|default:0}} - ₱ {{ request.GET.price_max|default:max_price}} </span>
        
        <button class="filter-btn">Filter</button>
      </form>
    </div>

      <!-- <input type="range" name="price_max" min="{{ min_price|default:0 }}" max="{{ max_price|default:1000 }}" value="{{ request.GET.price_max|default:max_price }}" id="priceRange">
      <span id="priceDisplay">₱{{ min_price|default:0}} - ₱ {{ request.GET.price_max|default:max_price}} </span> -->

    <div class="sidebar-section">
      <h3>Rating</h3>
      <ul class="rating-filter">
        <li><label><input type="checkbox"> <span>★★★★★</span> 5.0</label></li>
        <li><label><input type="checkbox"> <span>★★★★☆</span> 4.0 & up</label></li>
        <li><label><input type="checkbox"> <span>★★★☆☆</span> 3.0 & up</label></li>
        <li><label><input type="checkbox"> <span>★★☆☆☆</span> 2.0 & up</label></li>
        <li><label><input type="checkbox"> <span>★☆☆☆☆</span> 1.0 & up</label></li>
      </ul>
    </div>

    <div class="sidebar-section">
      <h3>Popular Tag</h3>
      <div class="tags">
        <span class="tag">Fresh</span>
        <span class="tag">Organic</span>
        <span class="tag">Sale</span>
        <span class="tag">New</span>
        <span class="tag">Local</span>
      </div>
    </div>

    <div class="sidebar-section discount-banner">
      <img src="{% static 'img/discount.jpg' %}" alt="Discount" />
      <div>
        <strong>79% Discount</strong> on your first order<br>
        <a href="#" class="shop-now-btn">Shop Now &rarr;</a>
      </div>
    </div>

    <div class="sidebar-section sale-products">
      <h3>Sale Products</h3>
      <div class="sale-product-card">
        <img src="{% static 'img/tomato.jpg' %}" alt="Tomato">
        <div><span>Tomato</span><span class="sale-price">₱2.00</span></div>
      </div>
      <div class="sale-product-card">
        <img src="{% static 'img/cabbage.jpg' %}" alt="Cabbage">
        <div><span>Chinese Cabbage</span><span class="sale-price">₱3.00</span></div>
      </div>
      <div class="sale-product-card">
        <img src="{% static 'img/eggplant.jpg' %}" alt="Eggplant">
        <div><span>Green Eggplant</span><span class="sale-price">₱2.50</span></div>
      </div>
    </div>
  </aside>

  <!-- Main Product Grid -->
  <main class="product-gallery">

    <div class="gallery-controls">
      <select id="sortDropdown">
        <option>Sort by: Latest</option>
        <option>Price: Low to High</option>
        <option>Price: High to Low</option>
        <option>Rating: High to Low</option>
      </select>
      <span class="results-count">32 results found</span>
    </div>


    <div class="product-grid">
      {% for product in products %}
        <div class="product-card">
          <!-- Whole product card clickable -->
          <a href="{% url 'main:product_detail' product.id %}" class="card-link">
            <div class="product-img-wrap">
              <img src="{{ product.image_url }}" alt="{{ product.name }}">
              {% if product.stock == 0 %}
                <span class="stock-out-badge">Out of stock</span>
              {% endif %}
            </div>
            <div class="product-info">
              <h3>{{ product.name }}</h3>
              <div class="price">₱{{ product.price }}</div>
              <div class="stock">{{ product.stock }} in stock</div>
            </div>
          </a>

          <!-- Add to Cart redirects to product detail -->
          <a href="{% url 'main:product_detail' product.id %}" class="add-cart-link">
            <button class="add-cart-btn" {% if product.stock == 0 %}disabled{% endif %}>
              Add to cart
            </button>
          </a>
        </div>
      {% endfor %}
    </div>




      <!-- Add more cards or later loop through products with Django -->
    </div>

    <div class="pagination">
      <button>&laquo;</button>
      <button class="active">1</button>
      <button>2</button>
      <button>3</button>
      <button>4</button>
      <button>&raquo;</button>
    </div>
  </main>
</div>


    <!-- ==== vvv MODALS (hidden by default) vvv ==== -->

    <!--Product Miniview-->
    {% include 'shared/product_miniview_cart.html' %}

    <!-- ==== ^^^ MODALS (hidden by default) ^^^ ==== -->


<script>
document.querySelectorAll('#categoryForm input[type=radio]')
  .forEach(radio => {
    radio.addEventListener('change', () => {
      document.getElementById('categoryForm').submit();
    });
  });
</script>

<script>
const form = document.getElementById('filterForm');

document.querySelectorAll('#filterForm input[name=category]').forEach(radio => {
  radio.addEventListener('change', () => form.submit());
});

document.getElementById('sortDropdown').addEventListener('change', () => form.submit());

const priceRange = document.getElementById('priceRange');
const priceDisplay = document.getElementById('priceDisplay');
priceRange.addEventListener('input', () => {
  priceDisplay.textContent = `₱{{ min_price|default:0 }} - ₱${priceRange.value}`;
});

priceRange.addEventListener('change', () => form.submit());
</script>

{% endblock %}
