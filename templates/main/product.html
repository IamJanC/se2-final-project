{% extends 'shared/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/product.css' %}">

<div class="product-container">
  <div class="product-image">
    <img src="{{ product.image_url }}" alt="{{ product.name }}">
  </div>

  <div class="product-details">
    <h2 class="product-name">{{ product.name }}</h2>
    <p class="product-price">₱ {{ product.price }}</p>
    <p class="product-category">Category: {{ product.category }}</p>
    <p class="product-stock {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
      {% if product.stock > 0 %}
        In stock: {{ product.stock }}
      {% else %}
        Out of Stock
      {% endif %}
    </p>
    <p class="product-description">{{ product.description }}</p>

    <!-- Messages block to show success or errors -->
    {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          <li class="message {{ message.tags }}">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if product.stock > 0 %}
      <form method="post" action="{% url 'cart:add_to_cart' product.id %}">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ product.id }}">

        <!-- Quantity Selector inside form -->
        <div class="quantity-container">
          <p class="lexend-300">Quantity:</p>

          <div class="quantity-selector">
            <button type="button" class="qty-btn minus" aria-label="Decrease quantity">−</button>
            <input type="number" name="quantity" class="quantity-input" value="1" min="1" max="{{ product.stock }}">
            <button type="button" class="qty-btn plus" aria-label="Increase quantity">+</button>
          </div>
        </div>

        <button type="submit" class="add-cart-btn">Add to Cart</button>
      </form>
    {% else %}
      <button class="add-cart-btn" disabled>Out of Stock</button>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const minusBtn = document.querySelector('.qty-btn.minus');
    const plusBtn = document.querySelector('.qty-btn.plus');
    const qtyInput = document.querySelector('.quantity-input');

    if (minusBtn && plusBtn && qtyInput) {
      minusBtn.addEventListener('click', () => {
        let val = parseInt(qtyInput.value, 10) || 1;
        if (val > parseInt(qtyInput.min || '1', 10)) {
          qtyInput.value = val - 1;
        }
      });

      plusBtn.addEventListener('click', () => {
        let val = parseInt(qtyInput.value, 10) || 1;
        const max = parseInt(qtyInput.max || '9999', 10);
        if (val < max) {
          qtyInput.value = val + 1;
        }
      });

      qtyInput.addEventListener('input', () => {
        let val = parseInt(qtyInput.value, 10) || 1;
        const min = parseInt(qtyInput.min || '1', 10);
        const max = parseInt(qtyInput.max || '9999', 10);
        if (val < min) qtyInput.value = min;
        else if (val > max) qtyInput.value = max;
      });
    }
  });
</script>

{% endblock %}
