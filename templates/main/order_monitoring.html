{% extends 'shared/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Your Shopping Cart - AgriHub Philippines{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/order_monitoring.css' %}">


<main>

    <div class="order-content">

        <div class="cart-title">
            <div class="order-info">
                <h3>Order Details</h3>
                <h4>&middot; {{ order.created_at|date:"F j, Y" }} &middot; {{ order.items.count }} Products</h4>
            </div>


            <a href="{% url 'orders:my_orders' %}?tab={{ mapped_status }}" class="back-link">
                Back to Orders
            </a>
        </div>



        <div class="orders-personal-info">


            <!-- Orders Address Card (Left) -->
            <div class="orders-address-card">
                <div class="address-card-title">
                    <h3>Address Information</h3>
                </div>

                <div class="orders-top-section">
                    <div class="label-top">
                        <span class="address-label">{{ order.label }}</span>
                    </div>
                </div>

                <div class="upper-address-label-section">
                    <p class="address-card-name">{{ order.full_name }}</p>
                </div>

                <div class="middle-address-section">
                    <p class="address-card-address">
                        {{ order.house }}, {{ order.street }}, Dalig, Antipolo, Rizal 1870
                    </p>
                    <p class="address-card-landmark">
                        Landmark: {{ order.landmark }}
                    </p>
                </div>

                <div class="lower-address-contact-section">
                    <p class="address-card-email">{{ order.email }}</p>
                    <p class="address-card-phone">{{ order.phone }}</p>
                </div>
            </div>


            <!-- Payment Information (Right)-->
            <div class="payment-information">

                <div class="order-information-right">
                    <div class="summary-row">
                        <span>Order ID:</span>
                        <span>{{ order.id }}</span>
                    </div>

                    <div class="summary-row">
                        <span>Payment Method:</span>
                        <span>Cash on Delivery</span>
                    </div>

                    <div class="summary-row divider"></div>

                    <div class="summary-row" id="items-total-group">
                        <span>Item(s) Total</span>
                        <span>PHP {{ items_total|floatformat:2|intcomma }}</span>
                    </div>

                    <div class="summary-row" id="shop-discount-group">
                        <span>Shop Discount</span>
                        <span>PHP {{ shop_discount|floatformat:2|intcomma }}</span>
                    </div>

                    <div class="summary-row divider"></div>

                    <div class="summary-row" id="subtotal-group">
                        <span>Subtotal</span>
                        <span>PHP {{ subtotal|floatformat:2|intcomma }}</span> 
                    </div>

                    <div class="summary-row" id="shipping-fee-group">
                        <span>Shipping Fee</span>
                        <span>PHP {{ shipping_fee|floatformat:2|intcomma }}</span>
                    </div>

                    <div class="summary-row divider"></div>

                    <div class="summary-row total" id="final-total-group">
                        <span>Total ({{ order.items.count }} items)</span>
                        <span><strong>PHP {{ final_total|floatformat:2|intcomma }}</strong></span>
                    </div>
                </div>


            </div>

        </div>



         <!-- Order Progress Bar -->
        <div class="order-progress">
            {% for s in statuses %}
                <div class="step {% if forloop.counter0 <= current_index %}completed{% else %}pending{% endif %}">
                    <div class="circle">{{ forloop.counter|stringformat:"02d" }}</div>
                    <span class="label">
                        {% if s == "pending" %}Order Placed
                        {% elif s == "shipped" %}Processing
                        {% elif s == "delivered" %}On the Way
                        {% elif s == "completed" %}Order Received
                        {% elif s == "cancelled" %}Cancelled
                        {% endif %}
                    </span>
                </div>

                {% if not forloop.last %}
                    <div class="bar {% if forloop.counter0 < current_index %}completed{% endif %}"></div>
                {% endif %}
            {% endfor %}
        </div>
        {% comment %} <div class="order-progress">

            <!-- Step 1 -->
            <div class="step completed">
                <div class="circle">01</div>
                <span class="label">Order Placed</span>
            </div>

            <!-- Bar -->
            <div class="bar completed"></div>

            <!-- Step 2 -->
            <div class="step completed">
                <div class="circle">02</div>
                <span class="label">Processing</span>
            </div>

            <!-- Bar -->
            <div class="bar"></div>

            <!-- Step 3 -->
            <div class="step pending">
                <div class="circle">03</div>
                <span class="label">On the Way</span>
            </div>

            <!-- Bar -->
            <div class="bar"></div>

            <!-- Step 4 -->
            <div class="step pending">
                <div class="circle">04</div>
                <span class="label">Order Received</span>
            </div>

        </div> {% endcomment %}



        <!-- Product Summary Section -->
        <div class="orders-main-product-section">
            <div class="orders-product-header">
                <div class="product-col" id="product-column-name">Product</div>
                <div class="price-col">Price</div>
                <div class="qty-col">Quantity</div>
                <div class="subtotal-col">Subtotal</div>
            </div>

            {% for item in order.items.all %}
            <div class="orders-product-row">
                <div class="product-col product-info">
                    <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}" class="product-img">
                    <span class="product-name">{{ item.product.name }}</span>
                </div>
                <div class="price-col">₱ {{ item.product.price|floatformat:2|intcomma }}</div>
                <div class="qty-col">x{{ item.quantity }}</div>
                <div class="subtotal-col">₱ {{ item.subtotal|floatformat:2|intcomma }}</div>
            </div>
            {% endfor %}
        </div>




    </div>



</main>

{% endblock %}