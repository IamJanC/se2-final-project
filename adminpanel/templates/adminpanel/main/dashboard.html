{% extends 'adminpanel/shared/admin_base.html' %}

{% block title %}Dashboard{% endblock %}
{% block header_title %}Dashboard{% endblock %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminpanel/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <!-- === DASHBOARD === -->
    <div id="dashboard" class="tab-content active">
        
        <!-- Number Cards -->
        <div class="number-cards-section">

            <!-- Total Sales -->
            <div class="number-cards" id="sales-card">
                <div class="number-cards-top">
                    <h3>Total Sales</h3>
                    
                    <div class="dropdown-wrapper">
                        <svg class="kebab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="6" r="2" fill="#000000"></circle>
                            <circle cx="12" cy="12" r="2" fill="#000000"></circle>
                            <circle cx="12" cy="18" r="2" fill="#000000"></circle>
                        </svg>
                        <ul class="dropdown-menu">
                            <li>Last 7 days</li>
                            <li>Last 30 days</li>
                            <li>This Month</li>
                            <li>Custom Range…</li>
                        </ul>
                    </div>
                </div>

                <div class="number-cards-timeline">
                    <span>Last 30 days</span>
                </div>

                <div class="number-cards-sales-current">
                    <h1>₱{{ current_sales }}</h1>
                    <span id="current-sales">Sales</span>

                    <div class="sales-current-group">
                        {% if sales_change_percent_raw > 0 %}
                            <div class="sales-current-up-group">
                                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" fill="#000000">
                                    <path d="M32 2C15.432 2 2 15.432 2 32s13.432 30 30 30s30-13.432 30-30S48.568 2 32 2zm5.143 28.305V49H26.857V30.305H16L32 15l16 15.305H37.143z" fill="#5c842d"></path>
                                </svg>
                                <span class="sales-status-up">{{ sales_change_percent_up }}%</span>
                            </div>
                        {% elif sales_change_percent_raw < 0 %}
                            <div class="sales-current-down-group">
                                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" fill="#000000">
                                    <path d="M32 2C15.432 2 2 15.432 2 32s13.432 30 30 30s30-13.432 30-30S48.568 2 32 2zm0 47L16 33.695h10.857V15h10.285v18.695H48L32 49z" fill="#842d2d"></path>
                                </svg>
                                <span class="sales-status-down">{{ sales_change_percent_down }}%</span>
                            </div>
                        {% else %}
                            <div class="sales-current-neutral-group">
                                <span class="sales-status-neutral">0%</span>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="number-cards-sales-previous">
                    <span>Previous 30 days (₱{{ previous_sales }})</span>
                </div>
            </div>

            <!-- Total Orders -->
            <div class="number-cards" id="orders-card">
                <div class="number-cards-top">
                    <h3>Total Orders</h3>
                    
                    <div class="dropdown-wrapper">
                        <svg class="kebab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="6" r="2" fill="#000000"></circle>
                            <circle cx="12" cy="12" r="2" fill="#000000"></circle>
                            <circle cx="12" cy="18" r="2" fill="#000000"></circle>
                        </svg>
                        <ul class="dropdown-menu">
                            <li>Last 7 days</li>
                            <li>Last 30 days</li>
                            <li>This Month</li>
                            <li>Custom Range…</li>
                        </ul>
                    </div>
                </div>

                <div class="number-cards-timeline">
                    <span>Last 30 days</span>
                </div>

                <div class="number-cards-orders-current">
                    <h1>{{ current_orders_count }}</h1>
                    <span id="current-orders">Orders</span>

                    <div class="orders-current-group">
                        {% if orders_change_percent_raw > 0 %}
                            <div class="orders-current-up-group">
                                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" fill="#000000">
                                    <path d="M32 2C15.432 2 2 15.432 2 32s13.432 30 30 30 30-13.432 30-30S48.568 2 32 2zm5.143 28.305V49H26.857V30.305H16L32 15l16 15.305H37.143z" fill="#5c842d"></path>
                                </svg>
                                <span class="orders-status-up">{{ orders_change_percent_up }}%</span>
                            </div>
                        {% elif orders_change_percent_raw < 0 %}
                            <div class="orders-current-down-group">
                                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" fill="#000000">
                                    <path d="M32 2C15.432 2 2 15.432 2 32s13.432 30 30 30 30-13.432 30-30S48.568 2 32 2zm0 47L16 33.695h10.857V15h10.285v18.695H48L32 49z" fill="#842d2d"></path>
                                </svg>
                                <span class="orders-status-down">{{ orders_change_percent_down }}%</span>
                            </div>
                        {% else %}
                            <div class="orders-current-neutral-group">
                                <span class="orders-status-neutral">0%</span>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="number-cards-orders-previous">
                    <span>Previous 30 days ({{ previous_orders_count }})</span>
                </div>
            </div>

            <!-- Total Pending Orders & Cancelled Orders -->
            <div class="number-cards" id="pending-card">
                <div class="number-cards-top">
                    <h3>Pending & Cancelled Orders</h3>
                    
                    <div class="dropdown-wrapper">
                        <svg class="kebab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="6" r="2" fill="#000000"></circle>
                            <circle cx="12" cy="12" r="2" fill="#000000"></circle>
                            <circle cx="12" cy="18" r="2" fill="#000000"></circle>
                        </svg>
                        <ul class="dropdown-menu">
                            <li>Last 7 days</li>
                            <li>Last 30 days</li>
                            <li>This Month</li>
                            <li>Custom Range…</li>
                        </ul>
                    </div>
                </div>

                <div class="number-cards-timeline">
                    <span>Last 30 days</span>
                </div>

                <div class="pending-cancelled-section">
                    <div class="current-pending-group">
                        <h3>Pending</h3>
                        <div class="current-pending-group-numbers">
                            <h1>{{ pending_orders_count }}</h1>
                            <div class="current-pending-group-numbers-spans">
                                <span class="pending-orders-label">Users</span>
                                <span class="pending-orders-num">{{ pending_orders_users_count }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="vertical-divider"></div>

                    <div class="current-cancelled-group">
                        <h3>Cancelled</h3>
                        <div class="current-cancelled-group-numbers">
                            <h1>{{ cancelled_orders_count }}</h1>
                            <div class="current-cancelled-group-numbers-spans">
                                {% if cancelled_change_percent_up > 0 %}
                                    <div class="cancelled-current-up-group">
                                        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" fill="#000000">
                                            <path d="M32 2C15.432 2 2 15.432 2 32s13.432 30 30 30s30-13.432 30-30S48.568 2 32 2zm5.143 28.305V49H26.857V30.305H16L32 15l16 15.305H37.143z" fill="#5c842d"></path>
                                        </svg>
                                        <span class="orders-status-up">{{ cancelled_change_percent_up }}%</span>
                                    </div>
                                {% elif cancelled_change_percent_down > 0 %}
                                    <div class="cancelled-current-down-group">
                                        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" fill="#000000">
                                            <path d="M32 2C15.432 2 2 15.432 2 32s13.432 30 30 30s30-13.432 30-30S48.568 2 32 2zm0 47L16 33.695h10.857V15h10.285v18.695H48L32 49z" fill="#842d2d"></path>
                                        </svg>
                                        <span class="orders-status-down">{{ cancelled_change_percent_down }}%</span>
                                    </div>
                                {% else %}
                                    <span class="orders-status-neutral">0%</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Statistics -->
        <div class="product-dashboard-section">
            <div class="moving-products">

                <!-- Fast Moving Products -->
                <div class="fast-moving-products-section">
                    <div class="fast-moving-product-top">
                        <h3>Fast Moving Products</h3>
                        <div class="dropdown-wrapper">
                            <svg class="kebab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="6" r="2" fill="#000000"></circle>
                                <circle cx="12" cy="12" r="2" fill="#000000"></circle>
                                <circle cx="12" cy="18" r="2" fill="#000000"></circle>
                            </svg>
                            <ul class="dropdown-menu">
                                <li>Last 7 days</li>
                                <li>Last 30 days</li>
                                <li>This Month</li>
                                <li>Custom Range…</li>
                            </ul>
                        </div>
                    </div>

                    <div class="number-cards-timeline">
                        <span>Last 7 days</span>
                    </div>

                    <div class="fast-moving-product-header">
                        <div class="product-col">Product</div>
                        <div class="price-col">Price</div>
                        <div class="qty-col">Total Order</div>
                        <div class="subtotal-col">Total Sales</div>
                        <div class="subtotal-col">Status</div>
                    </div>

                    {% if fast_moving_products %}
                        {% for product in fast_moving_products %}
                        <div class="fast-moving-product-row">
                            <div class="product-col">
                                <img src="{{ product.product__image_url }}" alt="{{ product.product__name }}" class="product-img">
                                <span class="product-name">{{ product.product__name }}</span>
                            </div>
                            <div class="price-col">₱{{ product.product__price }}</div>
                            <div class="qty-col">{{ product.total_quantity }}</div>
                            <div class="subtotal-col">₱{{ product.total_sales|floatformat:2 }}</div>
                            <div class="status-col">
                                <span class="status-badge {{ product.stock_status }}">{{ product.stock_label }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="fast-moving-product-row" style="text-align:center; padding:1rem;">
                            <em>No fast moving products in the last 7 days</em>
                        </div>
                    {% endif %}
                </div>

                <!-- Slow Moving Products -->
                <div class="slow-moving-products-section">
                    <div class="slow-moving-product-top">
                        <h3>Slow Moving Products</h3>
                        <div class="dropdown-wrapper">
                            <svg class="kebab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="6" r="2" fill="#000000"></circle>
                                <circle cx="12" cy="12" r="2" fill="#000000"></circle>
                                <circle cx="12" cy="18" r="2" fill="#000000"></circle>
                            </svg>
                            <ul class="dropdown-menu">
                                <li>Last 7 days</li>
                                <li>Last 30 days</li>
                                <li>This Month</li>
                                <li>Custom Range…</li>
                            </ul>
                        </div>
                    </div>

                    <div class="number-cards-timeline">
                        <span>Last 7 days</span>
                    </div>

                    <div class="slow-moving-product-header">
                        <div class="product-col">Product</div>
                        <div class="price-col">Price</div>
                        <div class="qty-col">Total Order</div>
                        <div class="subtotal-col">Total Sales</div>
                        <div class="subtotal-col">Status</div>
                    </div>

                    {% if slow_moving_products %}
                        {% for product in slow_moving_products %}
                        <div class="slow-moving-product-row">
                            <div class="product-col">
                                <img src="{{ product.product__image_url }}" alt="{{ product.product__name }}" class="product-img">
                                <span class="product-name">{{ product.product__name }}</span>
                            </div>
                            <div class="price-col">₱{{ product.product__price }}</div>
                            <div class="qty-col">{{ product.total_quantity }}</div>
                            <div class="subtotal-col">₱{{ product.total_sales|floatformat:2 }}</div>
                            <div class="status-col">
                                <span class="status-badge {{ product.stock_status }}">{{ product.stock_label }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="slow-moving-product-row" style="text-align:center; padding:1rem;">
                            <em>No slow moving products in the last 7 days</em>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Low Stock Alerts -->
        <div class="low-stock-alerts-section">
            <div class="low-stock-alerts-top">
                <h3>Low Stock Alerts</h3>
                <div class="dropdown-wrapper">
                    <svg class="kebab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="6" r="2" fill="#000000"></circle>
                        <circle cx="12" cy="12" r="2" fill="#000000"></circle>
                        <circle cx="12" cy="18" r="2" fill="#000000"></circle>
                    </svg>
                    <ul class="dropdown-menu">
                        <li>Last 7 days</li>
                        <li>Last 30 days</li>
                        <li>This Month</li>
                        <li>Custom Range…</li>
                    </ul>
                </div>
            </div>

            <div class="number-cards-timeline">
                <span>Current Stock Status</span>
            </div>

            <div class="low-stock-alerts-header">
                <div class="product-col">Product</div>
                <div class="price-col">Price</div>
                <div class="stock-col">Stock Left</div>
            </div>

            {% if low_stock_products %}
                {% for product in low_stock_products %}
                <div class="low-stock-alerts-row">
                    <div class="product-col">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-img">
                        <span class="product-name">{{ product.name }}</span>
                    </div>
                    <div class="price-col">₱{{ product.price }}</div>
                    <div class="stock-col">{{ product.stock }}</div>
                </div>
                {% endfor %}
            {% else %}
                <div class="low-stock-alerts-row" style="text-align:center; padding:1rem;">
                    <em>No low-stock items</em>
                </div>
            {% endif %}
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity-dashboard-section">

            <!-- Recent Transactions -->
            <div class="recent-transaction-dashboard">
                <h3>Recent Transactions</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Customer ID</th>
                            <th>Order Date</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if recent_transactions %}
                            {% for transaction in recent_transactions %}
                            <tr>
                                <td>{{ transaction.customer_id }}</td>
                                <td>{{ transaction.order_date }}</td>
                                <td>{{ transaction.order_time }}</td>
                                <td><span class="status-badge {{ transaction.status_class }}">{{ transaction.status_label }}</span></td>
                                <td>₱{{ transaction.amount|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align:center; padding:1rem;">
                                    <em>No recent transactions</em>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <!-- Recent Sessions -->
            <div class="recent-session-dashboard">
                <h3>Recent Session Logs</h3>
                <ul>
                    {% if recent_sessions %}
                        {% for session in recent_sessions %}
                        <li>User-{{ session.user_id }} ({{ session.username }}) logged in at {{ session.time }}</li>
                        {% endfor %}
                    {% else %}
                        <li><em>No recent sessions</em></li>
                    {% endif %}
                </ul>
            </div>

        </div>

    </div>

</div>
{% endblock %}